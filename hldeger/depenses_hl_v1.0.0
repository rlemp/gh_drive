#!/bin/bash

#########REANME################
#sur le bureau, ce script coinverti in fichier 'input', exemple:

#migros 100
#coop 50
#boulangerie 25

#en un fichier temp sur le bureau en format hledger.journal
#le fichier temp peut etre corriger/copier dans le terminal avec l'editeur micro

############################

cd ~/Bureau/

echo ""
read -p 'etablir/corriger fichier-depenses entrant  ; ctrl S  ctrl Q enter pour continuer'
echo ""
micro input

echo '; +++++++++++++' > output

date_ajd=$(date +%Y-%m-%d)

# Une seule redirection pour toutes les Ã©critures
{
    while IFS=' ' read -r description montant; do
        if [[ -n "$description" && -n "$montant" ]]; then
            echo "$date_ajd  $description"
            echo "   assets:ccp    -$montant"
            echo "   expenses:alimentation     $montant"
            echo ""
        fi
    done < input
} >> output

echo ""
read -p 'corriger fichier de transactions sortant ; ctrl S  ctrl Q enter pour continuer'
echo ""
micro output 

#cp hledger.journal hledger.journal.bak
#cat output >> hledger.journal 
# 
#micro   hledger.journal

#rm input
#rm output

# version definitive
cp ~/.hledger.journal  ~/.hledger.journal.bak
cat output >> ~/.hledger.journal 
 
 echo ""
 read -p 'verifier le journal ; ctrl S  ctrl Q enter pour terminer'
 echo ""
micro   ~/.hledger.journal

rm input
rm output

